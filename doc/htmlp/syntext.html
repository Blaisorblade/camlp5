<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" 
 "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html>
<head>
  <!-- $Id: syntext.html,v 1.5 2007/07/22 04:28:41 deraugla Exp $ -->
  <!-- Copyright (c) 2007 INRIA -->
  <title>syntax extensions</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <link rel="stylesheet" type="text/css" href="styles/base.css"
        title="Normal" />
</head>
<body>

<div id="menu">
</div>

<div id="content">

<h1 class="top">Syntax extensions</h1>

<p>Camlp5 allows to extend the syntax of the ocaml language, and even
  change the whole syntax.</p>

<p>It uses for that one of its parsing tools:
  the <a href="grammars.html">extensible grammars</a>.

<p>To understand the whole syntax in the examples given in this chapter,
  it is a good thing to know this parsing tool, but we shall try to give
  some minimal explanations to allow the reader to follow them.</p>

<p>A syntax extension is an ocaml object file (ending with ".cmo" or
  ".cma") which is loaded inside camlp5. The source of this file uses
  calls to the specific statement EXTEND applied to entries defined in
  the camlp5 module "<tt>Pcaml</tt>".</p>

<div id="tableofcontents">
</div>

<h2>Entries</h2>

<p>The grammar of ocaml contains several entries, corresponding to the
  major notions of the language, which are modifiable this way, and
  even erasable. They are defined in this module "<tt>Pcaml</tt>".</p>

<p>Most important entries:</p>

<ul>
  <li><tt>expr</tt>: the expressions.</li>
  <li><tt>patt</tt>: the patterns.</li>
  <li><tt>ctyp</tt>: the types.</li>
  <li><tt>str_item</tt>: the structure items, i.e. the items between
    "struct" and "end", and the toplevel phrases in a ".ml" file.</li>
  <li><tt>sig_item</tt>: the signature items, i.e. the items between
    "sig" and "end", and the toplevel phrases in a ".mli" file.</li>
  <li><tt>module_expr</tt>: the module expressions.</li>
  <li><tt>module_type</tt>: the module types.</li>
</ul>

<p>Entries of object programming:</p>

<ul>
  <li><tt>class_expr</tt>: the class expressions.</li>
  <li><tt>class_type</tt>: the class types.</li>
  <li><tt>class_str_item</tt>: the objects items.</li>
  <li><tt>class_sig_item</tt>: the objects types items.</li>
</ul>

<p>Main entries of files and interactive toplevel parsing:</p>

<ul>
  <li><tt>implem</tt>: the phrases that can be found in a ".ml" file.</li>
  <li><tt>interf</tt>: the phrases that can be found in a ".mli" file.</li>
  <li><tt>top_phrase</tt>: the phrases of the interactive toplevel.</li>
  <li><tt>use_file</tt>: the phrases that can be found in a file
    included by the directive "use".</li>
</ul>

<p>Extra useful entries also accessible:</p>

<ul>
  <li><tt>let_binding</tt>: the bindings "expression = pattern" found in
    the "let" statement.</li>
  <li><tt>type_declaration</tt>: the bindings "name = type" found in
    the "type" statement.</li>
</ul>

<h2>Syntax tree quotations</h2>

<p>A grammar rule is a list of rule symbols followed by the semantic
  action, i.e. the result of the rule. This result is a syntax tree,
  whose type is the type of the extended entry. The description of the
  types of the syntax tree are in the camlp5 module
  "<tt>MLast</tt>".</p>

<p>However, there is a simpler way to make values of these syntax tree
  types: the system <a href="quot.html">quotations</a>. With this system,
  it is possible to represent syntax tree in concrete syntax, between
  specific parentheses.</p>

<p>For example, the syntax node of the "if" statement, supposing you
  know the meaning of the constructors of the "<tt>MLast</tt>" module
  would be:</p>

<pre>
  MLast.ExIfe loc e1 e2 e3
</pre>

<p>where loc is the source location, and e1, e2, e3 are the expressions
  constituting the if statement. With quotations, we could write it like
  this:</p>

<pre>
  &lt:expr&lt; if $e1$ then $e2$ else $e3$ >>
</pre>

<p>With quotations, it is possible to build pieces of program as
  complex as desired. See the chapter
  about <a href="ml_ast.html">syntax trees</a>.</p>

<h2>An example</h2>

<p>... work in progress ...</p>

<div class="trailer">
</div>

</div>

</body>
</html>
