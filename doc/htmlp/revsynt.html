<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" 
 "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html>
<head>
  <!-- $Id: revsynt.html,v 1.11 2007/07/20 01:44:35 deraugla Exp $ -->
  <!-- Copyright (c) 2007 INRIA -->
  <title>revised syntax</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <link rel="stylesheet" type="text/css" href="styles/base.css" />
</head>
<body>

<div id="menu">
</div>

<div id="content">

<h1 class="top">The revised syntax</h1>

<p>The revised syntax is an alternative syntax of ocaml. It is close
  to the normal syntax, we present here only the differences between
  the two syntaxes.</p>

<div id="tableofcontents">
</div>

<h2>Structure and signature items</h2>

<ul>
  <li>Structure and signature items, objects items always end with a
    single semicolon which is mandatory.</li>

  <li>In structures, the declaration of a value is introduced by the
    keyword "value", instead of "let":

    <table width="75%" class="centered">
      <tr>
        <th align="left" class="half">OCaml</th>
        <th align="left" class="half">Revised</th>
      </tr>
      <tr>
        <td><tt>let x = 23;;</tt></td>
        <td><tt>value x = 23;</tt></td>
      </tr>
      <tr>
        <td><tt>let x = 23 in x + 7;;&nbsp;&nbsp;</tt></td>
        <td><tt>let x = 23 in x + 7;</tt></td>
      </tr>
    </table>
  </li>

  <li>In signatures, the declaration of a value is also introduced by
    the keyword "value", instead of "val":
    <table width="75%" class="centered">
      <tr>
        <th align="left" class="half">OCaml</th>
        <th align="left" class="half">Revised</th>
      </tr>
      <tr>
        <td><tt>val x : int;;&nbsp;&nbsp;</tt></td>
        <td><tt>value x : int;</tt></td>
      </tr>
    </table>
  </li>
</ul>

<h2>Expressions and Patterns</h2>

<h3>Imperative constructions</h3>

<ul>
  <li>The sequence is introduced by the keyword "do" followed by "{"
    and terminated by "}"; it is possible to put a semicolon after the
    last expression:

    <table width="75%" class="centered">
      <tr>
        <th align="left" class="half">OCaml</th>
        <th align="left" class="half">Revised</th>
      </tr>
      <tr>
        <td><tt>e1; e2; e3; e4&nbsp;&nbsp;</tt></td>
        <td><tt>do { e1; e2; e3; e4 }</tt></td>
      </tr>
    </table>
  </li>

  <li>The "do" after the "while" loop and the "for" loop are followed
    by a "{" and the loop end with "}"; it is possible to put a
    semicolon after the last expression:

    <table width="75%" class="centered">
      <tr>
        <th align="left" class="half">OCaml</th>
        <th align="left" class="half">Revised</th>
      </tr>
      <tr>
        <td><tt>while e1 do</tt></td>
        <td><tt>while e1 do {</tt></td>
      </tr>
      <tr>
        <td><tt>&nbsp;&nbsp;e1; e2; e3</tt></td>
        <td><tt>&nbsp;&nbsp;e1; e2; e3</tt></td>
      </tr>
      <tr>
        <td><tt>done</tt></td>
        <td><tt>}</tt></td>
      </tr>
      <tr>
        <td><tt></tt></td>
        <td><tt></tt></td>
      </tr>
      <tr>
        <td><tt>for i = e1 to e2 do&nbsp;&nbsp;</tt></td>
        <td><tt>for i = e1 to e2 do {</tt></td>
      </tr>
      <tr>
        <td><tt>&nbsp;&nbsp;e1; e2; e3</tt></td>
        <td><tt>&nbsp;&nbsp;e1; e2; e3</tt></td>
      </tr>
      <tr>
        <td><tt>done</tt></td>
        <td><tt>}</tt></td>
      </tr>
    </table>
  </li>
</ul>

<h3>Tuples and lists</h3>

<ul>
  <li>Parentheses are mandatory in tuples:
    <table width="75%" class="centered">
      <tr>
        <th align="left" class="half">OCaml</th>
        <th align="left" class="half">Revised</th>
      </tr>
      <tr>
        <td><tt>1, "hello", World</tt></td>
        <td><tt>(1, "hello", World)</tt></td>
      </tr>
    </table>
  </li>

  <li>The lists are always enclosed with brackets. A list is a left
    bracket, followed by a list of elements separated with semicolons,
    optionally followed by colon-colon and an element, and ended by a
    right bracket. Warning: the colon-colon is not an infix but is
    just part of the syntactic construction.
    <table width="75%" class="centered">
      <tr>
        <th align="left" class="half">OCaml</th>
        <th align="left" class="half">Revised</th>
      </tr>
      <tr>
        <td><tt>x :: y</tt></td>
        <td><tt>[x :: y]</tt></td>
      </tr>
      <tr>
        <td><tt>[x; y; z]</tt></td>
        <td><tt>[x; y; z]</tt></td>
      </tr>
      <tr>
        <td><tt>x :: y :: z :: t</tt></td>
        <td><tt>[x; y; z :: t]</tt></td>
      </tr>
    </table>
  </li>
</ul>

<h3>Irrefutable patterns</h3>

<p>An <em>irrefutable pattern</em> is a pattern where it is
  syntactilly visible that it never fails. They are used in some
  syntactic constructions. It is either:</p>

<ul>
  <li>A variable,</li>
  <li>The wildcard ``_'',</li>
  <li>The constructor ``()'',</li>
  <li>A tuple with irrefutable patterns,</li>
  <li>A record with irrefutable patterns,</li>
  <li>A type constraint with an irrefutable pattern.</li>
</ul>

<p>Notice that this definition is only syntactic: a constructor
  belonging to a type having only one constructor is not considered as
  an irrefutable pattern (except "()").</p>
  
<h3>Constructions with matching</h3>

<ul>
  <li>The keyword "function" no longer exists. Only "fun" is used.</li>

  <li>The pattern matchings, in constructions with "fun", "match" and
    "try" are closed with brackets: an open bracket "[" before the
    first case, and a close bracket "]" after the last case:
    <table width="75%" class="centered">
      <tr>
        <th align="left" class="half">OCaml</th>
        <th align="left" class="half">Revised</th>
      </tr>
      <tr>
        <td><tt>match e with</tt></td>
        <td><tt>match e with</tt></td>
      </tr>
      <tr>
        <td><tt>&nbsp;&nbsp;p1 -> e1</tt></td>
        <td><tt>[ p1 -> e1</tt></td>
      </tr>
      <tr>
        <td><tt>| p2 -> e2</tt></td>
        <td><tt>| p2 -> e2 ]</tt></td>
      </tr>
    </table>
    But if there is only one case and if the pattern is irrefutable,
      the brackets are not mandatory. These examples work identically
      in OCaml and in revised syntax:
    <table width="75%" class="centered">
      <tr>
        <th align="left" class="half">OCaml</th>
        <th align="left" class="half">Revised</th>
      </tr>
      <tr>
        <td><tt>fun x -> x</tt></td>
        <td><tt>fun x -> x</tt></td>
      </tr>
      <tr>
        <td><tt>fun {foo=(y, _)} -> y</tt></td>
        <td><tt>fun {foo=(y, _)} -> y</tt></td>
      </tr>
    </table>
  </li>

  <li>It is possible to write the empty function, raising the
    exception "Match_failure" whichever parameter is applied, the
    empty "match", raising "Match_failure" after having evaluated its
    expression, and the empty "try", equivalent to its expression
    without try:
<pre>
  fun []
  match e with []
  try e with []
</pre>
  </li>

  <li>The patterns after "let" and "value" must be irrefutable. The
    following OCaml expression:
<pre>
  let f (x::y) = ...
</pre>
    must be written:
<pre>
  let f = fun [ [x::y] -> ...
</pre>
  </li>

  <li>It is possible to use a construction "where", equivalent to "let",
    but usable only when where is only one binding. The expression:
<pre>
  e1 where p = e
</pre>
    is equivalent to:
<pre>
  let p = e in e1
</pre>
  </li>
</ul>

<h3>Mutables and assignment</h3>

<ul>
  <li>The statement "<tt>&lt;-</tt>" is written "<tt>:=</tt>":
    <table width="75%" class="centered">
      <tr>
        <th align="left" class="half">OCaml</th>
        <th align="left" class="half">Revised</th>
      </tr>
      <tr>
        <td><tt>x.f <- y</tt></td>
        <td><tt>x.f := y</tt></td>
      </tr>
    </table>
  </li>

  <li>The "ref" type is declared as a record type with one field named
    "val", instead of "contents". The operator "!" does not exist any
    more, and references are assigned like the other mutables:
    <table width="75%" class="centered">
      <tr>
        <th align="left" class="half">OCaml</th>
        <th align="left" class="half">Revised</th>
      </tr>
      <tr>
        <td><tt>x := !x + y</tt></td>
        <td><tt>x.val := x.val + y</tt></td>
      </tr>
    </table>
  </li>
</ul>

<p>...<em>to be continued</em>...</p>

<div class="trailer">
</div>

</div>

</body>
</html>
