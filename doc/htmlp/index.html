<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" 
 "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html>
<head>
  <!-- $Id: index.html,v 1.13 2007/07/25 10:32:43 deraugla Exp $ -->
  <!-- Copyright (c) 2007 INRIA -->
  <title>Camlp5</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <link rel="stylesheet" type="text/css" href="styles/base.css"
        title="Normal" />
</head>
<body>

<div id="menu">
</div>

<div id="content">

<h1 class="top">Overview</h1>

<p>Camlp5 is a preprocessor and pretty-printer for ocaml programs.</p>

<p>As a preprocessor, it allows to:</p>

<ul>

  <li>add syntax extensions,</li>
  <li>redefine the whole syntax of the language.</li>

</ul>

<p>As a pretty printer, it allows to:</p>

<ul>

  <li>display programs in a elegant way,</li>
  <li>convert from a syntax to another,</li>
  <li>check the results of syntax extensions.</li>

</ul>

<p>Camlp5 also provides some parsing and pretty printing tools.</p>

<p>It works as a shell command and can also be used in the ocaml
toplevel.</p>

<div id="tableofcontents">
</div>

<h2>Shell usage</h2>

<p>The main shell commands are:</p>

<ul>
  <li><tt>camlp5o</tt> : to treat files written in normal ocaml
  syntax,</li>
  <li><tt>camlp5r</tt> : to treat files written in an original syntax
    named the <a href="revsynt.html"><em>revised syntax</em></a>.</li>
</ul>

<p>These commands can be given as parameters of the
option <tt>-pp</tt> of the ocaml compiler. Examples:</p>

<pre>
  ocamlc -pp camlp5o foo.ml
  ocamlc -pp camlp5r bar.ml
</pre>

<p>This way, the parsing is done by camlp5. In case of syntax errors,
the parsing fails with an error message and the compilation is
aborted. Otherwise, the ocaml compiler continues with the syntax tree
provided by camlp5.</p>

<p>In the toplevel, it is possible to preprocess the input phrases by
loading one of the files "<tt>camlp5o.cma</tt>" or
"<tt>camlp5r.cma</tt>".  The common usage is:</p>

<pre>
  ocaml -I +camlp5 camlp5o.cma
  ocaml -I +camlp5 camlp5r.cma
</pre>

<h2>Parsing and Printing kits</h2>

<p>Parsing and printing extensions are ocaml object files, i.e. files
  with the extension "<tt>.cmo</tt>" or "<tt>.cma</tt>. They are the
  result of the compilation of ocaml source files containing what is
  necessary to do the parsing or printing extensions. These object
  files are named <em>parsing</em> or <em>printing kits</em>.</p>

<p>These files cannot be linked to produce executables because they
  generally call functions and use variables defined only in camlp5
  core, typically belonging to the module "<tt>Pcaml</tt>". The kits
  are destinated to be loaded by the camlp5 commands, either by their
  command arguments or by the source files using them through the
  directive "<tt>#load</tt>".</p>

<p>It is therefore important to compile the <em>kits</em> with the
  option "<tt>-c</tt>" of the ocaml compiler (i.e. just compilation,
  do not produce executable) and with the option "<tt>-I +camlp5</tt>"
  to inform the compiler to find module interfaces in installed camlp5
  library.</p>  

<p>In the ocaml toplevel, it is possible to use a kit by simply
  loading it with the directive "<tt>#load</tt>".</p>

<h2>Extending syntax</h2>

<p>A syntax extension is a camlp5 parsing kit. There are two ways to
  use a syntax extension:</p>

<ul>

  <li>Either by giving this object file as parameter to the camlp5
    command. For example:

<pre>
  ocamlc -pp "camlp5o ./myext.cmo" foo.ml
</pre>

  </li>

  <li>Or by adding the directive "<tt>#load</tt>" in the source file:

<pre>
  #load "./myext.cmo";;
</pre>

    and compile it simply like this:

<pre>
  ocamlc -pp camlp5o foo.ml
</pre>

  </li>

</ul>

<p>Several syntax extensions can be used for a single file. The way to
create one's own syntax extensions is explained further.</p>

<h2>Pretty printing</h2>

<p>Like for syntax extensions, the pretty printing are defined or
  extended through camlp5 printing kits. The main pretty printing kits
  provided by camlp5 are:</p>

<ul>

<li><tt>pr_o.cmo</tt>: to pretty print in normal syntax,</li>
<li><tt>pr_r.cmo</tt>: to pretty print in revised syntax.</li>

</ul>

<p>Examples: if we have a file, <tt>foo.ml</tt>, written in normal
syntax and and another one, <tt>bar.ml</tt>, written in revised
syntax, here are the commands to pretty print them in their own
syntax:</p>

<pre>
  camlp5o pr_o.cmo foo.ml
  camlp5r pr_r.cmo bar.ml
</pre>

<p>And how to convert them into the other syntax:</p>

<pre>
  camlp5o pr_r.cmo foo.ml
  camlp5r pr_o.cmo foo.ml
</pre>

<p>The way to create one's own pretty printing extensions is
explained further.</p>

<h2>Note: the revised syntax</h2>

<p>The <em>revised syntax</em> is a specific syntax whose aim is to
  resolve some syntax problems and inconsistencies of the normal ocaml
  syntax.  A chapter will explain the differences between the normal
  and the revised syntax.</p>

<p>All examples of this documentation are written in revised syntax.
  Even if you don't know it, it is not difficult to understand. The
  same examples can be written in normal syntax. In case of problems,
  refer to the chapter describing it.</p>

<div class="trailer">
</div>

</div>

</body>
</html>
