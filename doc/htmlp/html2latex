#!/bin/sh
# $Id: html2latex,v 1.29 2007/07/20 13:42:58 deraugla Exp $

FILES="index.html ptools.html revsynt.html parsers.html fparsers.html lexers.html grammars.html pretty.html opretty.html ml_ast.html pragma.html extfun.html"

/bin/echo '\documentclass[twoside]{report}
\usepackage{fullpage}

\def\tableau#1#2#3{%
\begin{center}
\begin{tabular}{#1}
\hline
\makebox[5cm][l]{#2} & \makebox[5cm][l]{#3} \\
\hline
}
\def\endtableau{\hline\end{tabular}\end{center}}
\def\entree#1#2{{\verb~#1~} & {\verb~#2~} \\}

\begin{document}

\def\cslversion{4.04}

\pagestyle{empty}
\begin{center}
~\vfill
\Huge           Camlp5 - Reference Manual \\
\Large          version \cslversion \\[1cm]
\large          Daniel de Rauglaudre \\
                \today \\[1cm]
\vfill
\normalsize	Copyright \copyright\ 2007 Institut National de
                Recherche en Informatique et Automatique

This document was generated by a shell script from the html documentation
pages.
\end{center}
\cleardoublepage
\setcounter{page}{1}
\pagestyle{plain}
\tableofcontents'

for i in $FILES; do
  /bin/echo '\cleardoublepage'
  cat $i |
  sed \
    -e 's/\\/\\backslash/g' \
    -e 's|<p [^>]*>|<p>|g' |
  sed \
    -e '{:b; /<\/p>$/N; s|<\/p>\n *|<\/p>|g; tb}' \
    -e 's|</p><p>|\n\n\\\n\n\\noindent |g' \
    -e '{s/^ *<p>/\\noindent /; s|</p>|\n\n|}' \
    -e '{/<tr>/N; s/^ *<tr>\n *<th/<th/}' \
    -e '{/<\/tr>/N; s|^ *</tr>\n||}' |
  sed \
    -e 's/{/\\{/g' -e 's/}/\\}/g' \
    -e '0,/<div id="content">/d' \
    -e '/<div id="tableofcontents">/,/<\/div>/d' \
    -e 's/^ *<h1[^>]*>/\\chapter{/' -e 's|</h1>|}|' \
    -e 's/^ *<h2>/\\section{/' -e 's|</h2>|}|' \
    -e 's/^ *<h3>/\\subsection{/' -e 's|</h3>|}|' \
    -e 's/^ *<h4>/\\subsubsection{/' -e 's|</h4>|}|' \
    -e 's/^ *<table width="75%" class="centered">/\\begin{tableau}{|l|l|}/' \
    -e 's|^ *</table>|\\end{tableau}|' \
    -e 's/^ *<th align="left" class="half">/  {/' -e 's|</th>|}|' \
    -e 's|^ *<tr>|  \\entree|' -e 's|^ *</tr>||' \
    -e 's| *<td>|    {|' -e 's|</td>|}|' \
    -e 's|<br/>||g' \
    -e 's/^ *<ul>/\\begin{itemize}/' -e 's|^ *</ul>|\\end{itemize}|' \
    -e 's/^ *<ol>/\\begin{enumerate}/' -e 's|^ *</ol>|\\end{enumerate}|' \
    -e 's/^ *<li>/\\item /' -e 's| *</li>||' \
    -e 's/^ *<dl><dd>/\\begin{description}\n\\item[\\ \\ \\ \\ \\ ]/' \
    -e 's|</dd></dl>|\\end{description}|' \
    -e 's/^ *<dl>/\\begin{description}/' -e 's|</dl>|\\end{description}|' \
    -e 's/^ *<dt>/\\item[/' -e 's|</dt>|]|' \
    -e 's/^ *<dd>/\n\\\n\n/' -e 's|</dd>||' \
    -e 's/^ *<pre[^>]*>/\\begin{verbatim}/' -e 's|^ *</pre>|\\end{verbatim}|' \
    -e 's/<code>/\\texttt{/g' -e 's|</code>|}|g' \
    -e 's/<tt>/\\texttt{/g' -e 's|</tt>|}|g' \
    -e 's/<em>/\\emph{/g' -e 's|</em>|}|g' \
    -e 's/<i>/\\emph{/g' -e 's|</i>|}|g' \
    -e 's/<b>/\\textbf{/g' -e 's|</b>|}|g' \
    -e 's/<a [^>]*>//g' -e 's|</a>||g' \
    -e 's/<span [^>]*>//g' -e 's|</span>||g' \
    -e 's/&lt;/</g' -e 's/&gt;/>/g' -e 's/&amp;/\\\&/g' -e 's/&nbsp;/\\ /g' \
    -e 's/_/\\_/g' \
    -e 's/#/\\#/g' \
    -e 's/\$/\\$/g' \
    -e 's/\\backslash/$\\backslash$/g' \
    -e '/\\begin{verbatim}/,/\\end{verbatim}/s/\\_/_/g' \
    -e '/\\begin{verbatim}/,/\\end{verbatim}/s/\\#/#/g' \
    -e '/\\begin{verbatim}/,/\\end{verbatim}/s/$\\backslash\$/\\/g' \
    -e '/\\begin{verbatim}/,/\\end{verbatim}/s/\\\$/$/g' \
    -e '/<div class="trailer">/,$d'
done

/bin/echo '\end{document}'
