#!/bin/sh
# $Id: html2latex,v 1.21 2007/07/19 01:27:36 deraugla Exp $

FILES="index.html ptools.html revsynt.html parsers.html fparsers.html lexers.html grammars.html pretty.html opretty.html ml_ast.html pragma.html extfun.html"

/bin/echo '\documentclass[twoside]{report}
\usepackage{fullpage}
\begin{document}

\def\cslversion{4.04}

\pagestyle{empty}
\begin{center}
~\vfill
\Huge           Camlp5 - Reference Manual \\
\Large          version \cslversion \\[1cm]
\large          Daniel de Rauglaudre \\
                \today \\[1cm]
\vfill
\normalsize	Copyright \copyright\ 2007 Institut National de
                Recherche en Informatique et Automatique

This document was generated by a shell script from the html documentation
pages.
\end{center}
\cleardoublepage
\setcounter{page}{1}
\pagestyle{plain}
\tableofcontents'

for i in $FILES; do
  /bin/echo '\cleardoublepage'
  cat $i |
  sed -e 's|<p [^>]*>|<p>|g' |
  sed \
    -e '{:b; /<\/p>$/N; s|<\/p>\n *|<\/p>|g; tb}' \
    -e 's|</p><p>|\n\n\\\n\n\\noindent |g' \
    -e '{s/^ *<p>/\\noindent /; s|</p>|\n\n|}' |
  sed \
    -e '{:b; /<\/dl>$/N; s|<\/dl>\n *|<\/dl>|g; tb}' \
    -e 's|</dl><dl>|</dl>\n\\\n<dl>|g' \
    -e 's|</dl>\([^\n]\)|</dl>\n\n\1|' |
  sed \
    -e '0,/<div id="content">/d' \
    -e '/<div id="tableofcontents">/,/<\/div>/d' \
    -e 's/^ *<h1[^>]*>/\\chapter{/' -e 's|</h1>|}|' \
    -e 's/^ *<h2>/\\section{/' -e 's|</h2>|}|' \
    -e 's/^ *<h3>/\\subsection{/' -e 's|</h3>|}|' \
    -e 's/^ *<h4>/\\subsubsection{/' -e 's|</h4>|}|' \
    -e 's/^ *<ul>/\\begin{itemize}/' -e 's|^ *</ul>|\\end{itemize}|' \
    -e 's/^ *<ol>/\\begin{enumerate}/' -e 's|^ *</ol>|\\end{enumerate}|' \
    -e 's/^ *<li>/\\item /' -e 's| *</li>||' \
    -e 's/^ *<dl>/\\begin{description}/' -e 's|</dl>|\\end{description}|' \
    -e 's/^ *<dt>/\\item[/' -e 's|</dt>|]|' \
    -e 's/^ *<dd>/\n\\\n\n/' -e 's|</dd>||' \
    -e 's/^ *<pre[^>]*>/\\begin{verbatim}/' -e 's|^ *</pre>|\\end{verbatim}|' \
    -e 's/<code>/\\texttt{/g' -e 's|</code>|}|g' \
    -e 's/<tt>/\\texttt{/g' -e 's|</tt>|}|g' \
    -e 's/<em>/\\emph{/g' -e 's|</em>|}|g' \
    -e 's/<i>/\\emph{/g' -e 's|</i>|}|g' \
    -e 's/<b>/\\textbf{/g' -e 's|</b>|}|g' \
    -e 's/<a [^>]*>//g' -e 's|</a>||g' \
    -e 's/<span [^>]*>//g' -e 's|</span>||g' \
    -e 's/&lt;/</g' -e 's/&gt;/>/g' \
    -e 's/_/\\_/g' \
    -e 's/#/\\#/g' \
    -e 's/\$/\\$/g' \
    -e '/\\begin{verbatim}/,/\\end{verbatim}/s/\\_/_/g' \
    -e '/\\begin{verbatim}/,/\\end{verbatim}/s/\\#/#/g' \
    -e '/\\begin{verbatim}/,/\\end{verbatim}/s/\\\$/$/g' \
    -e '/<div class="trailer">/,$d'
done

/bin/echo '\end{document}'
