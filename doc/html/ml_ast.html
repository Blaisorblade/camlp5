<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" 
 "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html>
<head>
  <!-- $Id$ -->
  <!-- Copyright (c) 2007 INRIA -->
  <title>Abstract tree in concrete syntax</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <link rel="shortcut icon" href="c4logo.png" />
  <link rel="stylesheet" type="text/css" href="styles/base.css" />
</head>
<body>

<div id="menu">
  <h1>- Camlp5 -</h1>
  <ul>
    <li>Parsing
      <ul>
        <li><a href="parsers.html">parsers</a></li>
        <li><a href="lexers.html">lexers</a></li>
        <li><a href="fparsers.html">functional parsers</a></li>
      </ul>
    </li>
    <li>Printing
      <ul>
        <li><a href="pretty.html">library module</a></li>
        <li><a href="opretty.html">programs</a></li>
      </ul>
    </li>
    <li>Other
      <ul>
        <li><a href="ml_ast.html">syntax tree</a></li>
        <li><a href="pragma.html">pragma directive</a></li>
        <li><a href="extfun.html">extensible functions</a></li>
      </ul>
    </li>
  </ul>
</div>

<div id="content">

<h1 class="top">Abstract tree in concrete syntax</h1>

<p>In Camlp5, one often uses syntax trees. For example, in grammars of
the language (semantic actions), in pretty printing (as patterns), in
optimizing syntax code (typically streams parsers). Syntax trees are
mainly defined by sum types, one for each kind of tree:
"<code>expr</code>" for expressions, "<code>patt</code>" for patterns,
"<code>ctyp</code>" for types, "<code>str_item</code>" for structure
items, and so on. Each node corresponds to a possible value of this
type.</p>

<p>This syntax tree is defined in the module "<code>MLast</code>"
provided by Camlp5.</p>

<p>For example, the syntax tree of the statement "<code>if</code>" can
be written:</p>

<pre>
MLast.ExIfe loc e1 e2 e3
</pre>

<p>Where "<code>loc</code>" is the location in the source, and
"<code>e1</code>", "<code>e2</code>" and "<code>e3</code>" are
respectively the expression after the "<code>if</code>", the one after
the "<code>then</code>" and the one after the "<code>else</code>".</p>

<p>In all programs, it is possible to manipulate syntax trees like
that.</p>

<p>However, the quotations systems of Camlp5 provides a quotation kit
named "<code>q_MLast.cmo</code>". When loaded, it is possible to
represent the syntax trees in concrete syntax. The example above can
be written:</p>

<pre>
&lt;:expr&lt; if $e1$ then $e2$ else $e3$ >>
</pre>

<p>The interest of this representation is when one must manipulate
complicated syntax trees. An example taken from the Camlp5 sources
is this quotation (found in a pattern):</p>

<pre>
&lt;:expr&lt;
  match try Some $f$ with [ Stream.Failure -> None ] with
  [ Some $p$ -> $e$
  | _ -> raise (Stream.Error $e2$) ]
>>
</pre>

<p>In abstract syntax, it should have been written:</p>

<pre>
MLast.ExMat _
  (MLast.ExTry _ (MLast.ExApp _ (MLast.ExUid _ "Some") f)
     [(MLast.PaAcc _ (MLast.PaUid _ "Stream") (MLast.PaUid _ "Failure"),
       None, MLast.ExUid _ "None")])
  [(MLast.PaApp _ (MLast.PaUid _ "Some") p, None, e);
   (MLast.PaAny _, None,
    MLast.ExApp _ (MLast.ExLid _ "raise")
      (MLast.ExApp _
         (MLast.ExAcc _ (MLast.ExUid _ "Stream") (MLast.ExUid _ "Error"))
         e2))]
</pre>

<p>Which is less readable.</p>

<p>Instead of thinking of "a syntax tree", the programmer has to think
of "a piece of program".</p>

<div class="trailer">

  <hr style="margin:0" /><div style="font-size: 80%"><em>Copyright 2007
      Daniel de Rauglaudre (INRIA)</em></div>

  <p class="bottom">
    <a href="http://validator.w3.org/check?uri=referer"><img
       src="http://www.w3.org/Icons/valid-xhtml11" style="border:0"
       alt="Valid XHTML 1.1" height="31" width="88" /></a>
  </p>

</div>

</div>

</body>
</html>
